# python_mop
python toolkit for monitor-oriented programming.
用于面向监控编程的 Python 工具包。

## 面向监控编程

面向监控编程 (Monitoring-Oriented Programming, MOP) 是一种软件开发和分析框架，旨在通过将形式规范与实现结合在一起，缩小它们之间的差距。在 MOP 中，运行时监控被视为构建可靠软件的基本原则，通过自动生成的监控器从指定的属性中自动合成并与原始系统集成，以在执行过程中检查其动态行为。当规范在运行时被违反或验证时，将触发用户定义的操作，这些操作可以是任何代码：从记录信息到运行时恢复。

MOP 的主要步骤如下：

1. 形式化规范：将系统的属性和行为使用形式化语言编写规范，这有助于明确系统的正确性要求。

2. 代码合成：根据形式化规范生成用于监控系统行为的监控器。这些监控器将在运行时与系统一起执行，用于检测系统是否违反或满足规范。

3. 集成和执行：将生成的监控器与系统集成，使其在运行时能够检查系统的行为，并在规范被违反或验证时触发预定义的操作。

4. 反馈和调整：基于运行时监控的结果，收集有关系统行为的反馈信息，并据此调整形式化规范和实现，进一步提高系统的可靠性。

优点：

1. 更清晰的规范：通过使用形式化的规范编写系统的属性和行为，MOP 有助于让开发人员清晰地理解系统的正确性要求。

2. 更高的可靠性：MOP 框架通过将监视器与系统集成，使得在运行时能够检测违反规范的行为，从而提高系统的可靠性。

3. 实时诊断与修复：通过根据运行时监控结果采取预定义的操作，MOP 可以实时诊断和修复系统的问题，减少错误导致的损失。

4. 验证与调整：MOP 收集的运行时监控结果可用于反馈，进而调整形式化规范和实现，提高系统的正确性和性能。

缺点：

1. 性能开销：运行时监控会引入一定程度的性能开销，从而可能影响到系统的运行速度。

2. 实现复杂性：MOP 框架要求开发人员熟悉形式化规范语言并能够根据规范生成监控器代码，这有时会增加实现的复杂性。

3. 不适用于所有领域：MOP 主要针对需要高可靠性的系统，对于一些领域或具体的应用场景，MOP 可能过于复杂或者不是最有效的方法。

## 使用方式


```python
import mop


@mop.monitor(lambda v: 4 < v < 6, lambda v: 5)
def add0(a, b):
    return a + b


print(add0(1.1, 1.1))


@mop.monitor(int, int)
def add1(a, b):
    return a + b


print(add1(1.1, 1.1))


# 2

@mop.monitor(mop.mrv() == 1, None, 1)
def add2(a, b):
    return a + b


print(add2(1.1, 1.1))
# 1
```
